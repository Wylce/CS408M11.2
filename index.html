<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Test AWS Lambda</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="">
</head>

<body>
    <h1>Simple Demo for PUT, GET, and DELETE</h1>
    <p id="lambda-info">
        <!-- loaded with AJAX -->
    </p>

    <button id="load-data">Load Data</button>
    <p>Loads data from the server</p>
    <script>
        document.getElementById("load-data").onclick = function () {
            let lambda = document.getElementById("lambda-info"); 
            let xhr = new XMLHttpRequest();
            xhr.responseType = "json";
            xhr.addEventListener("load", function () {
                //lambda.innerHTML = xhr.response;
                //console.log(xhr.response);
                fillTable(xhr.response);
            });
            xhr.open("GET", "https://67yk566zoe.execute-api.us-east-2.amazonaws.com/items");
            xhr.send();
        }

        function fillTable(data){
            let table = document.getElementById("data-table");
            let currentBody = document.getElementById("table-body")
            let tableBody = document.createElement("tbody");
            tableBody.id = "table-body";
            data.forEach((element => {
                console.log(element);
                const row = document.createElement("tr");

                for (var prop in element) {
                    if (element.hasOwnProperty(prop)) {
                        console.log(element[prop]);

                        const cell = document.createElement("td");
                        const text = document.createTextNode(element[prop]);

                        cell.appendChild(text);
                        row.appendChild(cell);
                    }
                }

                const deleteButton = document.createElement("button");
                deleteButton.textContent = "Delete";
                deleteButton.id = element.id;
                deleteButton.addEventListener('click', deleteData.bind(deleteButton, element.id));

                row.appendChild(deleteButton);

                tableBody.appendChild(row);
                
            }))

            //currentyBody = tableBody;
            //table.removeChild(currentBody);

            console.log(table.tBodies);

            table.replaceChild(tableBody, currentBody);

            
        }

    </script>

    <table id="data-table">
        <thead>
            <tr>
                <th scope="col">ID</th>
                <th scope="col">Name</th>
                <th scope="col">Price</th>
                <th scope="col">Action</th>
            </tr>
        </thead>
        <tbody id="table-body">

        </tbody>

    </table>

    <hr>
    <button id="send-data">Send Data</button>
    <p>Sends an example JSON object to the server with id 11111</p>
    <script>
        document.getElementById("send-data").onclick = function () {
            let xhr = new XMLHttpRequest();
            xhr.open("PUT", "https://67yk566zoe.execute-api.us-east-2.amazonaws.com/items");
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.send(JSON.stringify({
                "id": "123",
                "price": 19,
                "name": "test put value"
            }));
        }
    </script>

    <hr>
    <button id="delete-data">Delete Data</button>
    <p>Deletes a JSON object from the server with 11111</p>
    <script>
        document.getElementById("delete-data").addEventListener('click', deleteData);
        
        function deleteData (id) {
            console.log("deleted " + id);
            let xhr = new XMLHttpRequest();
            xhr.open("DELETE", "https://67yk566zoe.execute-api.us-east-2.amazonaws.com/items/" + id);
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.send();
        }
    </script>

    <form method="put" id="entry-form">
        <div>
            <label for="id-field">ID: </label>
            <input type="text" name="id-field" id="id-field" placeholder="placeholder" required>
        </div>
        <div>
            <label for="name-field">Name: </label>
            <input type="text" name="name-field" id="name-field" placeholder="placeholder" required>
        </div>
        <div>
            <label for="prive-field">Name: </label>
            <input type="text" name="price-field" id="price-field" placeholder="placeholder" required>
        </div>
        <input type="submit" value="Add Item">
    </form>

</body>

</html>
